<project name="Fetch srcIncluded zip" default="applyPatches" basedir=".">
	<property name="downloadFileName"
	          value="eclipse-sourceBuild-srcIncluded-${buildID}.zip" />
	<available file="${sdkSource}" property="skipFetch" value="true" />
	<target name="download" unless="skipFetch">
		<get src="http://download.eclipse.org/eclipse/downloads/drops/${buildID}/${downloadFileName}"
		     dest="${downloadFileName}"
		     usetimestamp="true" />
		<get src="http://download.eclipse.org/tools/orbit/downloads/drops/S20090307012903/bundles/com.ibm.icu.source_4.0.1.v20090109.jar"
		     dest="com.ibm.icu.source_4.0.1.v20090109.jar"
		     usetimestamp="true" />
	</target>
	<target name="newSources"
	        depends="download"
	        description="Replace old unzipped sources with unmodified from the downloaded zip">
		<delete dir="${sdkSource}" />
		<mkdir dir="${sdkSource}" />
		<unzip dest="${sdkSource}" src="${downloadFileName}" />
		<delete>
			<fileset dir="${sdkSource}">
				<include name="**/*.so" />
			</fileset>
		</delete>
	</target>
	<target name="applyPatches" depends="newSources">
		<patch patchfile="./patches/eclipse-buildswtnatives.patch"
		       dir="./${sdkSource}"
		       strip="0" />
		<!-- Fetch due to bug in srcIncluded generation.-->
		<copy tofile="${sdkSource}/plugins/com.ibm.icu.source_4.0.1.v20090109.jar"
		      file="com.ibm.icu.source_4.0.1.v20090109.jar" />
	</target>
	<target name="clean">
		<delete dir="${sdkSource}" />
	</target>
</project>
